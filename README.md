# 프로젝트 소개
페이먼츠 앱 라이브러리를 사용하기 위해 진행한 김 판매 플랫폼 프로젝트입니다. 사용자의 주요 제품 구매 흐름인 상품 목록, 상품 상세 정보, 장바구니, 결제, 결제 목록의 기본적인 흐름을 갖추도록 구성했습니다. MSW를 이용한 API Mocking, 상태 관리 도구에 대한 테스트에 대해 중점적으로 이해하고 구현했습니다.

# 고민의 흔적
## 서버 API에 종속되지 않는 독립적인 프론트엔드 환경 구축
이 프로젝트의 목적은 구매 프로세스 구현, 결제 앱 라이브러리 사용 두 가지였습니다. 그렇기 때문에 실제 API가 필수적인 상황은 아니었습니다. 다만 json으로 만들어진 Mock 데이터를 사용하기 보다 추후에 실제 API를 붙이는 상황까지 고려해 MSW를 활용한 Mocking API를 사용하기로 결정했습니다. 

MSW를 선택한 이유는 두 가지였습니다. 첫 번째는 네트워크 종속성을 제거해서 클라이언트 사이드에서 API 응답을 가상화하고, 이를 통제함으로써 서버에 종속되지 않으면서 독립적으로 원하는 상황을 만들 수 있다는 점이었습니다. 두번째로는 테스트 시에 Mocking API에 대한 제어권을 클라이언트에서 가지고 있기 때문에 여러 테스트 케이스에 대해 능동적으로 고려하고 개선할 수 있다는 점이었습니다. 이를 통해 서버 개발이 완료되지 않은 상황에서도 클라이언트 개발 및 테스트를 독립적으로 할 수 있었습니다.

## 사용자에게 제공될 데이터의 일관성을 위한 고민
데이터 타입 변경에 대한 런타임 오류를 방지하기 위해 Zod를 이용해 데이터 유효성 검사를 진행했습니다. 이 프로젝트는 API의 역할을 하는 MSW의 handler - 비동기 액션을 담당하는 Redux Toolkit - 비동기 Reducer를 사용하는 컴포넌트 혹은 커스텀 훅, 이렇게 데이터 흐름의 계층이 나뉜 상태였습니다. Redux Toolkit의 비동기 액션 함수 내부에서 데이터 유효성 검사를 통해 적절한 에러를 반환하면, 이를 컴포넌트 단에서 모달, 페이지 등의 적절한 UI로 에러 처리를 할 수 있게 되었습니다. 이를 통해 데이터의 무결성 보장, 데이터의 타입과 구조 검증, 데이터의 무결성 오류에 대한 빠른 대응을 보장할 수 있었습니다.

## 비동기 데이터 처리 로직의 테스트 전략 및 테스트
상태 관리 도구로 Redux Toolkit(RTK)를 선택하면서 이에 대한 테스트를 작성했습니다. 먼저 테스트 전략을 세워서 정말 테스트가 필요한 코드가 무엇인지 선별하는 과정을 거쳤습니다. 그 결과 RTK의 여러 프로세스 중 비동기 액션에 대해서만 테스트하는 것으로 결론 내렸습니다. 왜냐하면 현재 RTK를 서버와 데이터를 주고받는 비동기 처리에서만 사용하고 있었기 때문입니다. Reducer, 액션 생성자 등은 비동기 액션 테스트의 로딩, 성공, 실패 과정에 포함되는 과정이었기 때문에 테스트 우선순위에서 밀린다고 판단했습니다. 테스트가 필요한 비동기 액션을 나열하고, 상태 변화를 검증함으로써 비즈니스 로직의 정확성을 더할 수 있었고, 에러, 로딩에 대한 적절한 결과물을 테스트해서 프로젝트의 안정성을 보장할 수 있었습니다. 해당 경험을 블로그로 정리해 공유했습니다. 블로그 링크
